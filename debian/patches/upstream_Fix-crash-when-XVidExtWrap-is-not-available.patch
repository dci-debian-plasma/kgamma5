From 1918f145261a52a3b2a917c6784c2cebecbb4064 Mon Sep 17 00:00:00 2001
From: Christoph Feck <christoph@maxiom.de>
Date: Sun, 11 Nov 2012 02:19:01 +0100
Subject: [PATCH] Fix crash when XVidExtWrap is not available

This can happen when run as root
BUG: 292335
FIXED-IN: 4.10
---
 kcmkgamma/kgamma.cpp |   10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/kcmkgamma/kgamma.cpp b/kcmkgamma/kgamma.cpp
index ffe29ea..890ba99 100644
--- a/kcmkgamma/kgamma.cpp
+++ b/kcmkgamma/kgamma.cpp
@@ -70,7 +70,7 @@ KGamma::KGamma(QWidget* parent_P, const QVariantList &)
     :KCModule(KGammaConfigFactory::componentData(), parent_P), rootProcess(0)
 {
   bool ok;
-  GammaCorrection = true;
+  GammaCorrection = false;
   xv = new XVidExtWrap(&ok, NULL);
   if (ok) { /* KDE 4: Uneccessary test, when all KCM wrappers do conditional loading */
     xv->getGamma(XVidExtWrap::Red, &ok);
@@ -94,6 +94,7 @@ KGamma::KGamma(QWidget* parent_P, const QVariantList &)
       xv->setScreen(currentScreen);
 
       rootProcess = new KProcess;
+      GammaCorrection = true;
       setupUI();
       saved = false;
 
@@ -107,10 +108,9 @@ KGamma::KGamma(QWidget* parent_P, const QVariantList &)
       }
       load();
     }
-    else {  //something is wrong, show only error message
-      GammaCorrection = false;
-      setupUI();
-    }
+  }
+  if (!GammaCorrection) { //something is wrong, show only error message
+    setupUI();
   }
 }
 
-- 
1.7.10.4

